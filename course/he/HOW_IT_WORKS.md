# π§  ΧΧ™Χ Χ”Χ‘Χ•Χ ΧΆΧ•Χ‘Χ“ ΧΧ‘Χ¤Χ Χ™Χ

Χ‘Χ©Χ™ΧΆΧ•Χ¨ Χ”Χ–Χ” Χ Χ‘Χ™Χ ΧΧ Χ”Χ–Χ¨Χ™ΧΧ” Χ”ΧΧΧΧ” Χ©Χ Χ”ΧΧΆΧ¨Χ›Χ β€“ ΧΧ”ΧΧ©ΧΧΧ© Χ‘ΧΧΧ’Χ¨Χ Χ•ΧΆΧ“ ΧΧΧ΅Χ“ Χ”Χ ΧΧ•Χ Χ™Χ.

--- PAGE ---

## Χ–Χ¨Χ™ΧΧ Χ”ΧΧ™Χ“ΧΆ β€“ ΧΧ‘Χ ΧΆΧ

Χ”Χ–Χ¨Χ™ΧΧ” Χ”Χ‘Χ΅Χ™Χ΅Χ™Χ:

1. ΧΧ©ΧΧΧ© Χ©Χ•ΧΧ— Χ”Χ•Χ“ΧΆΧ” / ΧΧ•Χ—Χ¥ Χ›Χ¤ΧΧ•Χ¨ Χ‘ΧΧΧ’Χ¨Χ.
2. ΧΧΧ’Χ¨Χ Χ©Χ•ΧΧ— ΧΆΧ“Χ›Χ•Χ (Update) ΧΦΎWebhook Χ©ΧΧ.
3. FastAPI ΧΧ§Χ‘Χ ΧΧ Χ”-Request Χ‘Χ ΧΧ™Χ‘ `/webhook`.
4. ΧΧ Χ—Χ Χ• Χ‘Χ•Χ“Χ§Χ™Χ ΧΧ Χ–Χ” `message` ΧΧ• `callback_query`.
5. ΧΧΆΧ‘Χ™Χ¨Χ™Χ ΧΦΎhandlers Χ”ΧΧΧΧ™ΧΧ™Χ.
6. Χ©Χ•ΧΧ¨Χ™Χ ΧΧ™Χ¨Χ•ΧΆΧ™Χ Χ‘-DB.
7. ΧΧ—Χ–Χ™Χ¨Χ™Χ ΧΧ©Χ•Χ‘Χ” ΧΧΧ©ΧΧΧ© Χ“Χ¨Χ Telegram API.

--- PAGE ---

## main.py β€“ Χ Χ§Χ•Χ“Χ Χ”Χ›Χ Χ™Χ΅Χ”

Χ‘ΦΎ`main.py`:

- ΧΧ Χ—Χ Χ• Χ™Χ•Χ¦Χ¨Χ™Χ `FastAPI()`.
- ΧΧ’Χ“Χ™Χ¨Χ™Χ:
  - `GET /` β€“ ΧΧ‘Χ“Χ™Χ§Χ” Χ©Χ”Χ©Χ¨Χ Χ—Χ™.
  - `POST /webhook` β€“ Χ Χ§Χ•Χ“Χ Χ”Χ›Χ Χ™Χ΅Χ” ΧΧΆΧ“Χ›Χ•Χ Χ™Χ ΧΧΧΧ’Χ¨Χ.

Χ©Χ ΧΧ Χ—Χ Χ• Χ§Χ•Χ¨ΧΧ™Χ ΧΦΎ`handle_message` ΧΧ• `handle_callback`.

--- PAGE ---

## handlers/router.py β€“ Χ”Χ•Χ“ΧΆΧ•Χ ΧΧ§Χ΅Χ

Χ‘ΦΎ`handle_message`:

- ΧΧ Χ—Χ Χ• ΧΧ•Χ¦Χ™ΧΧ™Χ:
  - `user_id`
  - `text`
  - `language_code`
- ΧΧ–Χ”Χ™Χ Χ©Χ¤Χ” (`he` / `en`).
- Χ¨Χ•Χ©ΧΧ™Χ ΧΧ™Χ¨Χ•ΧΆ Χ‘ΦΎ`user_events`.
- ΧΧ Χ–Χ” `/start` β€“ Χ©Χ•ΧΧ—Χ™Χ ΧΧ¤Χ¨Χ™Χ Χ¨ΧΧ©Χ™.
- ΧΧ Χ–Χ” `/admin` β€“ ΧΧΆΧ‘Χ™Χ¨Χ™Χ ΧΦΎ`admin_handler`.

Χ–Χ” Χ”Χ©ΧΆΧ¨ Χ”Χ¨ΧΧ©Χ™ ΧΧ›Χ Χ”Χ•Χ“ΧΆΧ ΧΧ§Χ΅Χ.

--- PAGE ---

## handlers/callback_router.py β€“ Χ›Χ¤ΧΧ•Χ¨Χ™ Inline

Χ‘ΦΎ`handle_callback`:

- ΧΧ Χ—Χ Χ• Χ§Χ•Χ¨ΧΧ™Χ ΧΧ `callback["data"]`.
- ΧΧ Χ–Χ” ΧΧΧ—Χ™Χ Χ‘ΦΎ`menu_` β€“ ΧΧΆΧ‘Χ™Χ¨Χ™Χ ΧΦΎ`menu_callback`.
- ΧΧ Χ–Χ” ΧΧΧ—Χ™Χ Χ‘ΦΎ`course|` β€“ ΧΧΆΧ‘Χ™Χ¨Χ™Χ ΧΦΎ`course_callback`.

Χ›Χ ΧΧ Χ—Χ Χ• ΧΧ¤Χ¨Χ™Χ“Χ™Χ Χ‘Χ™Χ ΧΧ•Χ’Χ™Χ§Χ ΧΧ¤Χ¨Χ™Χ ΧΧ‘Χ™Χ ΧΧ•Χ’Χ™Χ§Χ Χ§Χ•Χ¨Χ΅.

--- PAGE ---

## db/events.py β€“ ΧΧ•Χ’ ΧΧ™Χ¨Χ•ΧΆΧ™Χ

Χ›Χ Χ¤ΧΆΧ•ΧΧ” Χ—Χ©Χ•Χ‘Χ” Χ©Χ Χ”ΧΧ©ΧΧΧ© Χ Χ¨Χ©ΧΧ Χ‘ΦΎ`user_events`:

- `event_type` β€“ ΧΧΧ©Χ: `message`, `button`
- `data` β€“ ΧΧ•Χ›Χ Χ”Χ”Χ•Χ“ΧΆΧ” / Χ”ΦΎcallback
- `created_at` β€“ ΧΧΧ™ Χ–Χ” Χ§Χ¨Χ”

Χ–Χ” ΧΧΧ¤Χ©Χ¨:

- Χ΅ΧΧΧ™Χ΅ΧΧ™Χ§Χ•Χ
- Χ Χ™ΧΧ•Χ— Χ”ΧΧ Χ”Χ’Χ•Χ
- Debugging

--- PAGE ---

## edu_log β€“ ΧΧ•Χ’Χ™Χ Χ—Χ™Χ Χ•Χ›Χ™Χ™Χ

Χ‘Χ›Χ Χ©ΧΧ‘ Χ—Χ©Χ•Χ‘ Χ‘Χ§Χ•Χ“, ΧΧ Χ—Χ Χ• Χ§Χ•Χ¨ΧΧ™Χ ΧΧ¤Χ•Χ Χ§Χ¦Χ™Χ•Χ Χ›ΧΧ•:

- `edu_step(...)`
- `edu_path(...)`
- `edu_warning(...)`

Χ›Χ©ΦΎ`DEBUG_MODE=true`, ΧΧ¨ΧΧ” Χ‘ΦΎLogs Χ©Χ Railway:

- ΧΧ™Χ–Χ” Χ ΧΧ™Χ‘ Χ”Χ•Χ¤ΧΆΧ
- ΧΧ™Χ–Χ” Χ©ΧΧ‘ Χ¨Χ¥
- ΧΧ™Χ¤Χ” Χ™Χ© Χ©Χ’Χ™ΧΧ”

Χ–Χ” Χ”Χ•Χ¤Χ ΧΧ Χ”Χ§Χ•Χ“ ΧΧ›ΧΧ™ ΧΧ™ΧΧ•Χ“Χ™, ΧΧ Χ¨Χ§ Χ¤Χ•Χ Χ§Χ¦Χ™Χ•Χ ΧΧ™.

--- PAGE ---

## Χ΅Χ™Χ›Χ•Χ

Χ”Χ‘Χ•Χ Χ©ΧΧ Χ”Χ•Χ Χ‘ΧΆΧ¦Χ:

- API Χ§ΧΧ (FastAPI)
- Χ©ΧΧ“Χ‘Χ¨ ΧΆΧ:
  - ΧΧΧ’Χ¨Χ
  - ΧΧ΅Χ“ Χ ΧΧ•Χ Χ™Χ
  - Redis
- Χ•ΧΧ Χ”Χ:
  - Χ§Χ•Χ¨Χ΅
  - ΧΧ©ΧΧ•ΧΧ™Χ
  - ΧΧ©Χ—Χ§
  - ΧΧ“ΧΧ™Χ

Χ‘Χ©Χ™ΧΆΧ•Χ¨Χ™Χ Χ”Χ‘ΧΧ™Χ Χ Χ¦ΧΧ•Χ ΧΧ›Χ Χ—ΧΧ§ Χ‘Χ Χ¤Χ¨Χ“.
