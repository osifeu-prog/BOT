# 🗄 INIT_DB  יצירת הטבלאות אוטומטית

בשיעור הזה נבין איך הקובץ `init_db.py` דואג לכך שהמערכת **תמיד תעלה עם מסד נתונים תקין**  בלי להיתקע על שגיאות כמו "table does not exist".

---

## למה צריך `init_db.py`?

במערכת שלנו יש כמה טבלאות:

- `admins`  אדמינים
- `buyers`  רוכשים
- `user_events`  לוג אירועים
- `slots_history`  היסטוריית משחק
- ועוד...

כשאתה מרים פרויקט חדש (למשל ב-Railway), מסד הנתונים מתחיל **ריק**.  
אם הקוד מנסה לכתוב לטבלה שלא קיימת  תקבל שגיאה.

`init_db.py` הוא סקריפט שמריץ:

- בדיקה אם כל טבלה קיימת
- יצירה שלה אם לא
- אפשרות להרחיב בעתיד ל"מיגרציות" מסודרות

---

## איך הסקריפט עובד בפועל?

בגדול, הוא:

1. מתחבר ל-Postgres דרך `DATABASE_URL`
2. מריץ `CREATE TABLE IF NOT EXISTS ...` לכל טבלה
3. סוגר את החיבור

הרעיון: **idempotent**  אפשר להריץ אותו כמה פעמים, והוא לא ישבור כלום.

---

## חיבור ל-Railway  Pre-deploy Command

ב-Railway הגדרנו:

- `Pre-deploy command`:  
  `python init_db.py`

כלומר:

- לפני כל Deploy
- Railway מריץ את `init_db.py`
- ורק אחרי שהטבלאות קיימות  הבוט עצמו עולה (`uvicorn main:app ...`)

זה אומר:

- אין מצב שהבוט יעלה בלי טבלאות
- אין מצב שתלמיד יתקע על `UndefinedTable` או `UndefinedColumn`

---

## למה זה חשוב לתלמידים שלך?

כשאתה מוכר את הערכה:

- הם לא צריכים להבין SQL לעומק
- הם לא צריכים לזכור ליצור טבלאות ידנית
- הם מקבלים **התנהגות צפויה**: "מרימים פרויקט → הכל עובד"

זה חלק מהערך של "ערכת סטארטאפ" ולא רק "קוד גולמי".

---

## איך אפשר להרחיב את זה?

בעתיד אפשר:

- להוסיף טבלת `migrations` שתשמור גרסאות
- להוסיף סקריפטים נפרדים לשדרוג סכימה
- לחבר כלי כמו Alembic אם רוצים רמת Enterprise

אבל בשלב הזה  `init_db.py` נותן:

- פשטות
- יציבות
- חוויית תלמיד חלקה

---

## משימה

1. פתח את `init_db.py` בקוד.
2. עבור טבלה-טבלה והבין:
   - מה השדות?
   - למה הם קיימים?
3. דמיין טבלה חדשה שהיית מוסיף (למשל: `user_balance` למשחקים).
4. כתוב לעצמך איך היית מוסיף אותה ל-`init_db.py`.

כך אתה מתרגל לחשוב כמו מי שבונה **פלטפורמה**, לא רק "בוט חד-פעמי".
